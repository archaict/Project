{ config, pkgs, lib, ... }:

{
  services.emacs.enable = true;
  services.emacs.client.enable = true;

  programs.emacs = {
    enable = true;
    package = pkgs.emacs;

    init = {
      enable = true;
      recommendedGcSettings = true;

      prelude = ''
        (push '(menu-bar-lines . 0) default-frame-alist)
        (push '(tool-bar-lines . nil) default-frame-alist)
        (push '(vertical-scroll-bars . nil) default-frame-alist)
        ;; Set up fonts early.
        (set-face-attribute 'default
                            nil
                            :height 80
                            :family "Iosevka")
        (set-face-attribute 'variable-pitch
                            nil
                            :family "Iosevka")
          (setq initial-major-mode 'org-mode)
          (setq global-auto-revert-mode 1)
          (setq backup-by-copying t)
          (setq backup-directory-alist '(("." . "~/.saves/")))
          (setq delete-old-versions t)
          (setq kept-new-versions 6)
          (setq kept-old-versions 2)
          (setq version-control t)
          (setq global-visual-line-mode 1)
          (setq-default indent-tabs-mode nil)
          (add-hook 'dired-mode-hook 'auto-revert-mode)
          (setq explicit-shell-file-name 
            (concat (getenv "HOME") "/.nix-profile/bin/zsh"))
          (setq sgml-quick-keys 'close)

          (scroll-bar-mode -1)        ; Disable visible scrollbar
          (tool-bar-mode -1)          ; Disable the toolbar
          (tooltip-mode -1)           ; Disable tooltips
          (set-fringe-mode 10)        ; Give some breathing room
          (menu-bar-mode -1)          ; Disable the menu bar
          
          (setq scroll-step            1)
          (setq scroll-conservatively  10000)
          (setq inhibit-startup-message t)
          (setq visible-bell nil)
          (setq use-package-always-ensure t)
          
          (setq whitespace-style '(face trailing tabs lines empty big-indent))
          
          (setq-default header-line-format " ")
          
          (defun on-after-init ()
            (unless (display-graphic-p (selected-frame))
              (set-face-background 'default "unspecified-bg" (selected-frame))))
          
          (add-hook 'window-setup-hook 'on-after-init)
          
          (column-number-mode)
          (global-prettify-symbols-mode t)
          (global-display-line-numbers-mode t)
          
          (dolist (mode '(;;org-mode-hook
          		term-mode-hook
          		shell-mode-hook
          		eshell-mode-hook))
            (add-hook mode (lambda () (display-line-numbers-mode 0))))
          
          (display-battery-mode 1)
      '';
    };
  };
}
